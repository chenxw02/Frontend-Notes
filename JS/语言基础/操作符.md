# 操作符

## 一元操作符

### 自增自减

*类比C中的自增自减符*

除了 `Number`，`String`、`Boolean`、`Object` 也可使用自增自减符

* `String`：转换为 `Number`，如不能转换则直接返回 `NaN`
* `Boolean`：转换为 `Number`
* `Object`：调用 `valueOf()` 取得可操作的值，`valueOf()` 方法不可用或者取到的值不是数值，则调用 `toString()` 方法返回字符串形式的值，再应用字符串的方法

**一些例子**

```js
let s1 = "2";
let s2 = "z";
let b = false;
let f = 1.1;
let o = {
	valueOf() {
		return -1;
	}
};

s1++;  // 值变成数值 3
s2++;  // 值变成 NaN
b++;   // 值变成数值 1
f--;   // 值变成 0.10000000000000009（因为浮点数不精确）
o--;   // 值变成-2
```

### 一元加减

*转换部分与自增自减规则相同*

## 位操作符

*注意：在 ES6 中，所有数值都以 64 位存储，但在进行位操作时，会先将 64 位数转换为 32 位数进行操作，最后再转换为 64 位数继续存储*。这导致了 `NaN` 和 `Infinity` 在位操作中会被当成 0 处理

**位操作比数值运算快很多**

### 有符号整数

*这部分可以参考计算机组成中的相关内容*

* 正数以原码存储

* 负数以补码存储

* 处理有符号整数时，无法访问第 31 位（符号位）

* 处理非数值时，会先调用 `Number`

* 在使用 `toString(2)` 将负数转换为字符串时，并不会返回补码，而是其相反数的二进制表示加上前缀负号

  ```js
  let num1 = 18;
  let str1 = num1.toString(2);  // '10010'
  
  let num2 = -18;
  let str2 = num2.toString(2);  // '-10010'
  ```

### 按位非

`~` ，返回数值的反码。结果等于对数值取反并减 1

### 按位与

`&`

### 按位或

`|` 

### 按位异或

`^`，相同得 0，不同得 1

### 左移

`<<`，空位填 0，左移一位相当于数值 *2

### 有符号右移

`>>`，空位填符号位，右移一位相当于数值 /2

### 无符号右移

`>>>`，对整个 32 位进行右移，空位填0

## 布尔操作符

### 逻辑非

* 一定返回布尔值
* 任何非 0 数（包括无穷）-> false
* `null`、`NaN`、`undefined` -> true
* `!!` 可以将任意数据类型转换为布尔型，效果与 `Boolean()` 相同

### 逻辑与

* 不一定返回布尔值
* 有操作数为`null`、`NaN`、`undefined` ->  `null`、`NaN`、`undefined`
* 短路操作：只有第一个操作数为 `false` 才会对第二个操作数求值

### 逻辑或

* 不一定返回布尔值
* 两个操作数为`null`、`NaN`、`undefined` ->  `null`、`NaN`、`undefined`
* 短路操作：只有第一个操作数为 `true` 才会对第二个操作数求值
* 可以避免给变量赋值 `null` 或 `undefined`

## 乘性操作符

### 乘法

* 超出表示范围 -> `Infinity` or `-Infinity`
* 任意操作数为 `NaN` -> `NaN`
* `Infinity` * `0` -> `NaN`
* `Infitity` * 非 `0` -> `Infinity` or `-Infinity`
* `Infitity` * `Infitity` -> `Infitity`

### 除法

* 一二条与乘法相同
* `Infitity` / `Infitity` -> 
* `0` / `0` -> `NaN`
* **非 `0` / `0`/ -> `Infinity` or `-Infinity`**
* `Infinity` 除以任何数 -> `Infinity` or `-Infinity`

### 模运算

* 被除数是无限值，除数是有限值 -> `NaN`
* 被除数是有限值，除数是 `0` -> `NaN``
* `Infinity` 除以`Infinity` -> `NaN`

### 指数运算

*ES7 新增*

`**` 与 `pow (x,y)` 效果相同

`=**`

## 加性操作符

关于 `Infinity`：如果算出来是 0，则返回 `NaN`，否则返回 `Infinity`

### 加法

* `Infinity` + `-Infinity` -> `NaN`
* `-0` + `+0` -> `+0`

当其中一个操作数为非数值时，加法的返回值总是 `String`

### 减法

* `Infinity` - `Infinity` -> `NaN`
* `+0` - `-0` -> `+0`

当其中一个操作数为非数值时，加法的返回值总是 `Number`

## 关系操作符

### 大小等于

优先按照 `Number` 进行比较，其次按照 `String` 比较，也就是说：

* 任一操作数为 `Number` -> 转换为 `Number`
* 存在 `Object` -> 先 `valueOf()`，没有则 `toString()`

注意：涉及 `NaN` 时都返回 `false`

### 相等

#### 等于和不等于

**会先进行类型转换，再进行比较**

优先级与转换规则与大小等于相同

进行比较时，有如下规则

* `null` == `undefined`
* `null` 和 `undefined` 不能转换为其他类型的值再进行比较（也就是说 null == 0` 返回 `false`，即使 `Number(null) == 0`）
* 比较对象时，如果两个操作数都指向同一个对象，则返回 `true`，否则返回 `false`

注意：涉及 `NaN` 时相等都返回 `false`，不等都返回 `true`； 即使是 `NaN == NaN` 也返回 `false`，因为按照规则 `NaN` 不等于 `NaN`

#### 全等和不全等

**不进行类型转换**

不管是全等还是不全等，返回  `true` 的前提都是数据类型相同，也就是说：

* 全等只有在数据类型相同且值相等时才返回 `true`
* 不全等只有在数据类型相同且值不相等时才返回 `true`

### 条件操作符

```js
let max = (num1 > num2) ? num1 : num2;
```

### 赋值操作符

### 逗号操作符

用于在一条语句中执行多个操作

```js
// 使用逗号辅助赋值

let num = (1, 2, 3); // num 的值为 0
```

